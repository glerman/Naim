<html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-jsonview/1.2.3/jquery.jsonview.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-jsonview/1.2.3/jquery.jsonview.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <script type="text/javascript" charset="utf-8">

        function execute(salariesFile, teachersFile, receiptTo, teachersToIterate, sendMails, sendFromNaim) {

           var queryParams = "salariesFilePath=" + salariesFile;
           queryParams += "&teacherFilePath=" + teachersFile;
           queryParams += "&sendMails=" + sendMails;
           queryParams += "&sendFromNaim=" + sendFromNaim;
           queryParams += "&teachersToIterate=" + teachersToIterate;
           queryParams += "&receiptTo=" + receiptTo;
           var url = '/salary?' + queryParams;
            $.getJSON(url, function(data) {
                var report = data["report"];
                if (report) {
                    var reportView = $('#reportView');
                    displayResponse(report, reportView);
                }
                var preview = data["salariesPreview"];
                if (preview) {
                    var previewView = $('#previewView');
                    displayResponse(preview, previewView);
                }
            });
        }

        function displayResponse(response, panelBody) {
            response = convertNewLine(response);
            panelBody.empty();
            panelBody.append("<p>" + response + "</p>");
            panelBody.parent().show();
        }

        function convertNewLine(str) {
            return str.replace(/(?:\r\n|\r|\n)/g, '<br />');
        }
    </script>
</head>

<body>
<div>
    <h1 align="center">Salary Mail Service</h1>
</div>

<div style="clear:both;"></div>

<div>

    <span class="input-group col-lg-1" style="float: left ;margin: 10px;">
        <label for="salariesFile">Select Salaries File</label>
        <input id="salariesFile" type="file"/>
    </span>

    <span class="input-group col-lg-2" style="float: left ;margin: 10px;">
        <label for="teachersFile">Select Teachers File</label>
        <input id="teachersFile" type="file"/>
    </span>

    <span class="input-group col-lg-2" style="float: left ;margin: 10px;">
        <span class="input-group-addon">Receipt To</span>
        <input id="receiptTo" class="form-control" type="text" value="נורמל מחקר"/>
    </span>

    <span class="input-group col-lg-2" style="float: left ;margin: 10px;">
        <span class="input-group-addon">Which Teachers</span>
        <select id="teachersToIterate" class="form-control">
            <option value="ONE" selected="selected">One</option>
            <option value="ALL">All</option>
        </select>
    </span>

    <div class="btn-group" data-toggle="buttons" style="float: left ;margin: 10px;">
        <label class="checkbox">
            <input id="sendMails" type="checkbox" autocomplete="off">Send Mails
        </label>
        <label class="checkbox">
            <input id="sendFromNaim" type="checkbox" autocomplete="off">Send From Naim
        </label>
    </div>

</div>

<div style="clear:both;"></div>

<div>

    <div style="clear:both;"></div>

    <a class="btn btn-primary" style="float: left ;margin: 10px;"
       onclick="
                  var salariesFile = $('#salariesFile').val();
                  var teachersFile = $('#teachersFile').val();
                  var receiptTo = $('#receiptTo').val();
                  var teachersToIterate = $('#teachersToIterate').val();
                  var sendMails = document.getElementById('sendMails').checked;
                  var sendFromNaim = document.getElementById('sendFromNaim').checked;
                  execute(salariesFile, teachersFile, receiptTo, teachersToIterate, sendMails, sendFromNaim);
    ">
    Execute
    </a>
</div>

<div style="clear:both;"></div>


<div class="panel panel-primary" id="report-panel" style="display: none;">
    <div class="panel-heading">Run Report</div>
    <div class="panel-body" id="reportView"></div>
</div>

<div class="panel panel-primary" id="preview-panel" style="display: none;">
    <div class="panel-heading">Preview</div>
    <div class="panel-body" id="previewView"></div>
</div>

</body>
</html>
